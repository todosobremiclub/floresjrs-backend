<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Cumpleaños - Flores Jrs</title>
<!-- Estilos básicos para layout y FullCalendar-->
<link href='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.css' rel='stylesheet' />
<style>
body { font-family: Arial, sans-serif; background-color: #004aad; color: #fff; margin: 0; }
.header { padding: 1rem; background-color: #002f6c; }
.today-box { padding: 1rem; background-color: #ffcc00; color: #000; margin: 1rem; border-radius: 5px; }
</style>
</head>
<body>
<div class="header"><h2>Cumpleaños</h2></div>

<div id="today-box" class="today-box">
  <h3>Hoy cumplen años:</h3>
  <ul id="today-list"></ul>
</div>

<div id="calendar"></div>

<script src='https://cdn.jsdelivr.net/npm/fullcalendar@6.1.9/index.global.min.js'></script>
<script>
const token = localStorage.getItem('token'); // Asumiendo que guardás el token aquí
fetch('/cumpleanios', {
  headers: { 'Authorization': token }
})
.then(resp => resp.json())
.then(data => {
  // ✅ Llenamos la caja de "Hoy cumplen..."
  const todayList = document.getElementById('today-list');
  if (data.hoy.length === 0) {
    todayList.innerHTML = '<li>No hay cumpleaños hoy</li>';
  } else {
    data.hoy.forEach(s => {
      const li = document.createElement('li');
      li.textContent = `${s.nombre} ${s.apellido}`;
      todayList.appendChild(li);
    });
  }

  // ✅ Ahora inicializamos el calendario
  const events = data.cumpleaños.map(s => {
    const fecha = new Date(s.fecha_nacimiento);
    // Asegúrate de poner año actual para que todos los cumples aparezcan en este año
    const anioActual = new Date().getFullYear();
    fecha.setFullYear(anioActual);
    return {
      title: `${s.nombre} ${s.apellido}`,
      start: fecha.toISOString().split('T')[0]
    };
  });

  const calendarEl = document.getElementById('calendar');
  const calendar = new FullCalendar.Calendar(calendarEl, {
    initialView: 'dayGridMonth',
    locale: 'es',
    events: events,
    height: 'auto',
  });
  calendar.render();
})
.catch(error => {
  console.error(error);
  alert('Error al cargar cumpleaños');
});
</script>
</body>
</html>
